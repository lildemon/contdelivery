(function(){var t=[].slice,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},e={}.hasOwnProperty,r=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};!function(t){"function"==typeof define&&null!=define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):this.Remix=t(jQuery)}(function(o){var i,u,s,l,c,p,a;return u={bind:function(t,n){var e,r,o,i,u;for(e=t.split(" "),this.hasOwnProperty("_callbacks")||this._callbacks||(this._callbacks={}),i=0,u=e.length;u>i;i++)r=e[i],(o=this._callbacks)[r]||(o[r]=[]),this._callbacks[r].push(n);return this},one:function(t,n){var e;return this.bind(t,e=function(){return this.unbind(t,e),n.apply(this,arguments)})},trigger:function(){var n,e,r,o,i,u,s;if(n=1<=arguments.length?t.call(arguments,0):[],r=n.shift(),o=null!=(s=this._callbacks)?s[r]:void 0){for(i=0,u=o.length;u>i&&(e=o[i],e.apply(this,n)!==!1);i++);return!0}},unbind:function(t,n){var e,r,o,i,u,s,l,c,p,a;if(0===arguments.length)return this._callbacks={},this;if(!t)return this;for(r=t.split(" "),s=0,c=r.length;c>s;s++)if(u=r[s],i=null!=(a=this._callbacks)?a[u]:void 0)if(n){for(o=l=0,p=i.length;p>l;o=++l)if(e=i[o],e===n){i=i.slice(),i.splice(o,1),this._callbacks[u]=i;break}}else delete this._callbacks[u];return this}},u.on=u.bind,u.off=u.unbind,l={trace:!0,logPrefix:"(Remix)",log:function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],this.trace?(this.logPrefix&&n.unshift(this.logPrefix),"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,n),this):void 0}},a=["included","extended"],c=function(){function t(){"function"==typeof this.init&&this.init.apply(this,arguments)}return t.include=function(t){var e,r,o;if(!t)throw new Error("include(obj) requires obj");for(e in t)r=t[e],n.call(a,e)<0&&(this.prototype[e]=r);return null!=(o=t.included)&&o.apply(this),this},t.extend=function(t){var e,r,o;if(!t)throw new Error("extend(obj) requires obj");for(e in t)r=t[e],n.call(a,e)<0&&(this[e]=r);return null!=(o=t.extended)&&o.apply(this),this},t.proxy=function(t){return function(n){return function(){return t.apply(n,arguments)}}(this)},t.prototype.proxy=function(t){return function(n){return function(){return t.apply(n,arguments)}}(this)},t}(),o.parseHTML=o.parseHTML||function(t){return t},i=function(t){function n(t){if(this.constructor.noTemplate){if(null==t)throw"No template component must created with node";this.node=o(t)}this.child_components={},this._parseRemixChild(),this._parseNode(),this.initialize()}return r(n,t),n.include(u),n.extend(u),n.loadTemplate=function(t){var n,e;return"string"==typeof t?~t.indexOf("<")?this.templateNode=o(o.parseHTML(t)):(e=o.get(t),e.done(function(t){return function(n){return t.templateNode=o(o.parseHTML(n))}}(this)),n=function(t){return function(){return t.templateNode=o(o.parseHTML("<span>Error loading template: "+templateStr+" </span>"))}}(this),e.fail(n),e.complete(function(t){return function(){return t.trigger("template-loaded")}}(this))):t.nodeType&&1===t.nodeType?this.templateNode=t:this.noTemplate=!0},n.prototype.initialize=function(){},n.prototype.onNodeCreated=function(){},n.prototype.addChild=function(t,n){return this[t]=n.setParent(this)},n.prototype.render=function(){return this.trigger("updated"),this.node},n.prototype.appendTo=function(t){return this.node.appendTo(t),this},n.prototype.nodeTrigger=function(){return this.node.trigger.apply(this.node,arguments)},n.prototype.delegateTo=function(t){return this.parent._delChildComp(this.constructor,this.key),t._regChildComp(this,this.constructor,this.key),this.parent=t,this.creator=this.creator.setParent(t),this},n.prototype.delegate=function(t){return t.delegateTo(this)},n.prototype.include=function(t,e){var r;return null==e&&(e=t,t=this.node),"function"==typeof e?(r=e(),t.append(r.node?r.node:r),r.delegateTo(this)):t.append(e instanceof n?e.node:e)},n.prototype.append=function(){return this.include.apply(this,arguments)},n.prototype.empty=function(){return this.node.empty()},n.prototype.destroy=function(t){var n,r,o,i,u;"function"==typeof this.onDestroy&&this.onDestroy(),t||this.node.remove(),u=this.child_components;for(n in u)if(e.call(u,n)){i=u[n];for(o in i)e.call(i,o)&&(r=i[o],r.destroy(!0))}return this.off(),this.node.off(),this.parent._delChildComp(this.constructor,this.key)},n.prototype._optimistRender=function(t){var n;return this.state=t,n=function(n){return function(){return n.render(t),setTimeout(n.proxy(n._clearComps),0)}}(this),this.constructor.templateNode||this.constructor.noTemplate?n():this.constructor.one("template-loaded",function(t){return function(){return t._parseNode(),n()}}(this)),this.node},n.prototype._getChildComp=function(t,n){var e,r;return null!=(e=this.child_components)&&null!=(r=e[t.$id])?r[n]:void 0},n.prototype._getAllChildComp=function(t){var n,e,r,o,i,u,s,l;if(!t){n=[],l=this.child_components;for(r in l){i=l[r];for(o in i)e=i[o],n.push(e)}return n}s=null!=(u=this.child_components)?u[t.$id]:void 0;for(o in s)return e=s[o]},n.prototype._clearComps=function(){var t,n,e,r;for(r=this._getAllChildComp(),n=0,e=r.length;e>n;n++)t=r[n],t._preserve||o.contains(document.documentElement,t.node[0])||t.destroy();return null},n.prototype._regChildComp=function(t,n,e){var r,o,i;if(r=(o=this.child_components)[i=n.$id]||(o[i]={}),null!=r[e])throw"child component already exist!";return r[e]=t,t},n.prototype._delChildComp=function(t,n){var e,r;return null!=(e=this.child_components)&&null!=(r=e[t.$id])?delete r[n]:void 0},n.prototype._parseRemixChild=function(){var t,n,e,r;if(this.remixChild&&"object"==typeof this.remixChild){e=this.remixChild,r=[];for(n in e)t=e[n],r.push(this.addChild(n,t));return r}},n.prototype._parseNode=function(){var t,n;return t=function(t){return function(){return t._parseRefs(),t._parseRemix(),t._parseEvents(),t.onNodeCreated()}}(this),this.constructor.templateNode?(n=this.node,this.node=this.constructor.templateNode.clone(),n&&n.replaceWith(this.node),t()):this.constructor.noTemplate?t():this.node=o(o.parseHTML('<span class="loading">loading..</span>'))},n.prototype._parseRefs=function(){return this.node.find("[ref]").not(this.node.find("[remix] [ref]")).each(function(t){return function(n,e){var r;return r=o(e),t[r.attr("ref")]=r}}(this))},n.prototype._parseRemix=function(){var t;return t=function(t){return function(n){var e,r,i,u,s,l;e=o(n),s=e.data();for(r in s)l=s[r],0===l.indexOf("@")&&(i=l.substring(1),s[r]=null!=t[i]?t.proxy(t[i]):function(n){return function(){if(t[n])return t[n]();throw""+n+" does not exist"}}(i));return u=t[e.attr("remix")](s,e.attr("key"),n),u.constructor.noTemplate?void 0:e.replaceWith(u.node)}}(this),this.node.find("[remix]").not(this.node.find("[remix] [remix]")).each(function(){return t(this)})},n.prototype._parseEvents=function(){var t,n,e,r,i,u,s,l;if(this.remixEvent&&"object"==typeof this.remixEvent){u=this.remixEvent,l=[];for(t in u)r=u[t],s=t.split(","),n=s[0],i=s[1],n=o.trim(n),i=o.trim(i),e=function(t){return function(n){return function(e){var r;return e.stopPropagation(),null!=(r=t[n])?r.call(t,e):void 0}}}(this)(r),l.push(i?this.node.on(n,i,e):this.node.on(n,e));return l}},n}(c),s=new i,p=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return r(n,t),n.include(u),n.id_counter=1,n.create=function(t,e){var u,l,c;return null==e&&(e=t,t=null),u=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return r(o,t),o.include(e),o.loadTemplate(e.template),o.$id=n.id_counter++,o}(i),c=function(t){var n;return n=function(e,r,o){var i;return r||(r="$default"),i=t._getChildComp(u,r),i||(i=new u(o),i.parent=t,i.creator=n,i.key=r,t._regChildComp(i,u,r)),i._optimistRender(e),i},n.setParent=c,n.get=function(n){return n||(n="$default"),t._getChildComp(u,n)},n.getAll=function(){return t._getAllChildComp(u)},n.destroyAll=function(){return o.each(n.getAll(),function(t,n){return n.destroy()})},n},l=c(s),t&&(n[t]=l),l},n}(c)})}).call(this);