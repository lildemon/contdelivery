(function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};!function(t){"function"==typeof define&&null!=define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):this.Remix=t(jQuery)}(function(o){var i,u,s,l,c,p,a;return u={bind:function(t,e){var n,r,o,i,u;for(n=t.split(" "),this.hasOwnProperty("_callbacks")||this._callbacks||(this._callbacks={}),i=0,u=n.length;u>i;i++)r=n[i],(o=this._callbacks)[r]||(o[r]=[]),this._callbacks[r].push(e);return this},one:function(t,e){var n;return this.bind(t,n=function(){return this.unbind(t,n),e.apply(this,arguments)})},trigger:function(){var e,n,r,o,i,u,s;if(e=1<=arguments.length?t.call(arguments,0):[],r=e.shift(),o=null!=(s=this._callbacks)?s[r]:void 0){for(i=0,u=o.length;u>i&&(n=o[i],n.apply(this,e)!==!1);i++);return!0}},unbind:function(t,e){var n,r,o,i,u,s,l,c,p,a;if(0===arguments.length)return this._callbacks={},this;if(!t)return this;for(r=t.split(" "),s=0,c=r.length;c>s;s++)if(u=r[s],i=null!=(a=this._callbacks)?a[u]:void 0)if(e){for(o=l=0,p=i.length;p>l;o=++l)if(n=i[o],n===e){i=i.slice(),i.splice(o,1),this._callbacks[u]=i;break}}else delete this._callbacks[u];return this}},u.on=u.bind,u.off=u.unbind,l={trace:!0,logPrefix:"(Remix)",log:function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],this.trace?(this.logPrefix&&e.unshift(this.logPrefix),"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,e),this):void 0}},a=["included","extended"],c=function(){function t(){"function"==typeof this.init&&this.init.apply(this,arguments)}return t.include=function(t){var n,r,o;if(!t)throw new Error("include(obj) requires obj");for(n in t)r=t[n],e.call(a,n)<0&&(this.prototype[n]=r);return null!=(o=t.included)&&o.apply(this),this},t.extend=function(t){var n,r,o;if(!t)throw new Error("extend(obj) requires obj");for(n in t)r=t[n],e.call(a,n)<0&&(this[n]=r);return null!=(o=t.extended)&&o.apply(this),this},t.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t.prototype.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t}(),o.parseHTML=o.parseHTML||function(t){return t},i=function(t){function e(t){if(this.constructor.noTemplate){if(null==t)throw"No template component must created with node";this.node=o(t)}this.child_components={},this._parseRemixChild(),this._parseNode(),this.initialize()}return r(e,t),e.include(u),e.extend(u),e.loadTemplate=function(t){var e,n;return"string"==typeof t?~t.indexOf("<")?this.templateNode=o(o.parseHTML(t)):(n=o.get(t),n.done(function(t){return function(e){return t.templateNode=o(o.parseHTML(e))}}(this)),e=function(t){return function(){return t.templateNode=o(o.parseHTML("<span>Error loading template: "+templateStr+" </span>"))}}(this),n.fail(e),n.complete(function(t){return function(){return t.trigger("template-loaded")}}(this))):t.nodeType&&1===t.nodeType?this.templateNode=t:this.noTemplate=!0},e.prototype.initialize=function(){},e.prototype.onNodeCreated=function(){},e.prototype.addChild=function(t,e){return this[t]=e.setParent(this)},e.prototype.render=function(){return this.trigger("updated"),this.node},e.prototype.appendTo=function(t){return this.node.appendTo(t),this},e.prototype.nodeTrigger=function(){return this.node.trigger.apply(this.node,arguments)},e.prototype.delegateTo=function(t){return this.parent._delChildComp(this.constructor,this.key),t._regChildComp(this,this.constructor,this.key),this.parent=t,this.creator=this.creator.setParent(t),this},e.prototype.delegate=function(t){return t.delegateTo(this)},e.prototype.include=function(t,n){var r;return null==n&&(n=t,t=this.node),"function"==typeof n?(r=n(),t.append(r.node?r.node:r),r.delegateTo(this)):t.append(n instanceof e?n.node:n)},e.prototype.append=function(){return this.include.apply(this,arguments)},e.prototype.empty=function(){return this.node.empty()},e.prototype.destroy=function(t){var e,r,o,i,u;"function"==typeof this.onDestroy&&this.onDestroy(),t||this.node.remove(),u=this.child_components;for(e in u)if(n.call(u,e)){i=u[e];for(o in i)n.call(i,o)&&(r=i[o],r.destroy(!0))}return this.off(),this.node.off(),this.parent._delChildComp(this.constructor,this.key)},e.prototype._optimistRender=function(t){var e;return this.data=t,e=function(e){return function(){return e.render(t),setTimeout(e.proxy(e._clearComps),0)}}(this),this.constructor.templateNode||this.constructor.noTemplate?e():this.constructor.one("template-loaded",function(t){return function(){return t._parseNode(),e()}}(this)),this.node},e.prototype._getChildComp=function(t,e){var n,r;return null!=(n=this.child_components)&&null!=(r=n[t.$id])?r[e]:void 0},e.prototype._getAllChildComp=function(t){var e,n,r,o,i,u,s,l;if(!t){e=[],l=this.child_components;for(r in l){i=l[r];for(o in i)n=i[o],e.push(n)}return e}s=null!=(u=this.child_components)?u[t.$id]:void 0;for(o in s)return n=s[o]},e.prototype._clearComps=function(){var t,e,n,r;for(r=this._getAllChildComp(),e=0,n=r.length;n>e;e++)t=r[e],t._preserve||o.contains(document.documentElement,t.node[0])||t.destroy();return null},e.prototype._regChildComp=function(t,e,n){var r,o,i;if(r=(o=this.child_components)[i=e.$id]||(o[i]={}),null!=r[n])throw"child component already exist!";return r[n]=t,t},e.prototype._delChildComp=function(t,e){var n,r;return null!=(n=this.child_components)&&null!=(r=n[t.$id])?delete r[e]:void 0},e.prototype._parseRemixChild=function(){var t,e,n,r;if(this.remixChild&&"object"==typeof this.remixChild){n=this.remixChild,r=[];for(e in n)t=n[e],r.push(this.addChild(e,t));return r}},e.prototype._parseNode=function(){var t,e;return t=function(t){return function(){return t._parseRefs(),t._parseRemix(),t._parseEvents(),t.onNodeCreated()}}(this),this.constructor.templateNode?(e=this.node,this.node=this.constructor.templateNode.clone(),e&&e.replaceWith(this.node),t()):this.constructor.noTemplate?t():this.node=o(o.parseHTML('<span class="loading">loading..</span>'))},e.prototype._parseRefs=function(){return this.node.find("[ref]").each(function(t){return function(e,n){var r;return r=o(n),t[r.attr("ref")]=r}}(this))},e.prototype._parseRemix=function(){return this.node.find("[remix]").each(function(t){return function(e,n){var r,i,u,s,l,c;if(r=o(n),i=r.data("remix"),!i){i=r.data();for(u in i)c=i[u],0===c.indexOf("@")&&(s=function(e){return function(){var n;if(n=e.substring(1),t[n])return t[n]();throw""+n+" does not exist"}}(c),i[u]=s)}return l=t[r.attr("remix")](r.data("remix")||r.data(),r.attr("key"),r[0]),l.constructor.noTemplate?void 0:r.replaceWith(l.node)}}(this))},e.prototype._parseEvents=function(){var t,e,n,r,i,u,s,l;if(this.remixEvent&&"object"==typeof this.remixEvent){u=this.remixEvent,l=[];for(t in u)r=u[t],s=t.split(","),e=s[0],i=s[1],e=o.trim(e),i=o.trim(i),n=function(t){return function(e){return function(n){var r;return n.stopPropagation(),null!=(r=t[e])?r.call(t,n):void 0}}}(this)(r),l.push(i?this.node.on(e,i,n):this.node.on(e,n));return l}},e}(c),s=new i,p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.include(u),e.id_counter=1,e.create=function(t,n){var u,l,c;return null==n&&(n=t,t=null),u=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return r(o,t),o.include(n),o.loadTemplate(n.template),o.$id=e.id_counter++,o}(i),c=function(t){var e;return e=function(n,r,o){var i;return r||(r="$default"),i=t._getChildComp(u,r),i||(i=new u(o),i.parent=t,i.creator=e,i.key=r,t._regChildComp(i,u,r)),i._optimistRender(n),i},e.setParent=c,e.get=function(e){return e||(e="$default"),t._getChildComp(u,e)},e.getAll=function(){return t._getAllChildComp(u)},e.destroyAll=function(){return o.each(e.getAll(),function(t,e){return e.destroy()})},e},l=c(s),t&&(e[t]=l),l},e}(c)})}).call(this);