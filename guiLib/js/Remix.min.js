(function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};!function(t){"function"==typeof define&&null!=define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):this.Remix=t("undefined"==typeof jQuery?Zepto:jQuery)}(function(i){var o,s,u,l,p,c,a;return s={bind:function(t,e){var n,r,i,o,s;for(n=t.split(" "),this.hasOwnProperty("_callbacks")||this._callbacks||(this._callbacks={}),o=0,s=n.length;s>o;o++)r=n[o],(i=this._callbacks)[r]||(i[r]=[]),this._callbacks[r].push(e);return this},one:function(t,e){var n;return this.bind(t,n=function(){return this.unbind(t,n),e.apply(this,arguments)})},trigger:function(){var e,n,r,i,o,s,u;if(e=1<=arguments.length?t.call(arguments,0):[],r=e.shift(),i=null!=(u=this._callbacks)?u[r]:void 0){for(o=0,s=i.length;s>o&&(n=i[o],n.apply(this,e)!==!1);o++);return!0}},unbind:function(t,e){var n,r,i,o,s,u,l,p,c,a;if(0===arguments.length)return this._callbacks={},this;if(!t)return this;for(r=t.split(" "),u=0,p=r.length;p>u;u++)if(s=r[u],o=null!=(a=this._callbacks)?a[s]:void 0)if(e){for(i=l=0,c=o.length;c>l;i=++l)if(n=o[i],n===e){o=o.slice(),o.splice(i,1),this._callbacks[s]=o;break}}else delete this._callbacks[s];return this}},s.on=s.bind,s.off=s.unbind,l={trace:!0,logPrefix:"(Remix)",log:function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],this.trace?(this.logPrefix&&e.unshift(this.logPrefix),"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,e),this):void 0}},a=["included","extended"],p=function(){function t(){"function"==typeof this.init&&this.init.apply(this,arguments)}return t.include=function(t){var n,r,i;if(!t)throw new Error("include(obj) requires obj");for(n in t)r=t[n],e.call(a,n)<0&&(this.prototype[n]=r);return null!=(i=t.included)&&i.apply(this),this},t.extend=function(t){var n,r,i;if(!t)throw new Error("extend(obj) requires obj");for(n in t)r=t[n],e.call(a,n)<0&&(this[n]=r);return null!=(i=t.extended)&&i.apply(this),this},t.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t.prototype.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t}(),i.parseHTML=i.parseHTML||function(t){return t},o=function(t){function e(t){if(this.constructor.noTemplate){if(null==t)throw"No template component must created with node";this.node=i(t)}this.child_components={},this.state={},this.refs={},this._initialRender=!0,this._parseRemixChild(),this._parseNode(),this.initialize()}return r(e,t),e.include(s),e.extend(s),e.loadTemplate=function(t){var e,n;if(null==t)return void(this.noTemplate=!0);if("string"==typeof t)return~t.indexOf("<")?this.templateNode=i(i.parseHTML(t)):(n=i.get(t),n.done(function(t){return function(e){return t.templateNode=i(i.parseHTML(e))}}(this)),e=function(t){return function(){return t.templateNode=i(i.parseHTML("<span>Error loading template: "+templateStr+" </span>"))}}(this),n.fail(e),n.complete(function(t){return function(){return t.trigger("template-loaded")}}(this)));if(t.nodeType&&1===t.nodeType)return this.templateNode=t;throw"What kind of template is this?"},e.prototype.initialize=function(){},e.prototype.onNodeCreated=function(){},e.prototype.addChild=function(t,e){return this[t]=e.setParent(this)},e.prototype.setState=function(t){return this._optimistRender(t)},e.prototype.render=function(){return this.trigger("updated"),this.node},e.prototype.appendTo=function(t){return this.node.appendTo(t),this},e.prototype.nodeTrigger=function(){return this.node.trigger.apply(this.node,arguments)},e.prototype.delegateTo=function(t){return this.parent._delChildComp(this.constructor,this.key),t._regChildComp(this,this.constructor,this.key),this.parent=t,this.creator=this.creator.setParent(t),this},e.prototype.delegate=function(t){return t.delegateTo(this)},e.prototype.append=function(t,n){var r;return null==n&&(n=this.node),"function"==typeof t?(r=t(),n.append(r.node?r.node:r),r.delegateTo(this)):n.append(t instanceof e?t.node:t)},e.prototype.include=function(t,e){return null!=e&&"function"==typeof e.empty&&e.empty(),this.append.apply(this,arguments)},e.prototype.empty=function(){return this.node.empty()},e.prototype.destroy=function(t){var e,r,i,o,s;"function"==typeof this.onDestroy&&this.onDestroy(),t||this.node.remove(),s=this.child_components;for(e in s)if(n.call(s,e)){o=s[e];for(i in o)n.call(o,i)&&(r=o[i],r.destroy(!0))}return this.off(),this.node.off(),this.parent._delChildComp(this.constructor,this.key)},e.prototype._optimistRender=function(t){var e;return"object"==typeof t?i.extend(this.state,t):this.state=t,e=function(e){return function(){return e._initialRender&&("function"==typeof e.initialRender&&e.initialRender(t),e._initialRender=!1),e.render(t),setTimeout(e.proxy(e._clearComps),0)}}(this),this.constructor.templateNode||this.constructor.noTemplate?e():this.constructor.one("template-loaded",function(t){return function(){return t._parseNode(),e()}}(this)),this.node},e.prototype._getChildComp=function(t,e){var n,r;return null!=(n=this.child_components)&&null!=(r=n[t.$id])?r[e]:void 0},e.prototype._getAllChildComp=function(t){var e,n,r,i,o,s,u,l,p;if(t){u=null!=(s=this.child_components)?s[t.$id]:void 0,p=[];for(i in u)n=u[i],p.push(n);return p}e=[],l=this.child_components;for(r in l){o=l[r];for(i in o)n=o[i],e.push(n)}return e},e.prototype._clearComps=function(){var t,e,n,r;for(r=this._getAllChildComp(),e=0,n=r.length;n>e;e++)t=r[e],t._preserve||i.contains(document.documentElement,t.node[0])||t.destroy();return null},e.prototype._regChildComp=function(t,e,n){var r,i,o;if(r=(i=this.child_components)[o=e.$id]||(i[o]={}),null!=r[n])throw"child component already exist!";return r[n]=t,t},e.prototype._delChildComp=function(t,e){var n,r;return null!=(n=this.child_components)&&null!=(r=n[t.$id])?delete r[e]:void 0},e.prototype._parseRemixChild=function(){var t,e,n,r;if(this.remixChild&&"object"==typeof this.remixChild){n=this.remixChild,r=[];for(e in n)t=n[e],r.push(this.addChild(e,t));return r}},e.prototype._parseNode=function(){var t,e;return t=function(t){return function(){return t._parseRefs(),t._parseRemix(),t._parseEvents(),t.onNodeCreated()}}(this),this.constructor.templateNode?(e=this.node,this.node=this.constructor.templateNode.clone(),e&&e.replaceWith(this.node),t()):this.constructor.noTemplate?t():this.node=i(i.parseHTML('<span class="loading">loading..</span>'))},e.prototype._parseRefs=function(){return this.node.find("[ref]").not(this.node.find("[remix] [ref]")).each(function(t){return function(e,n){var r;return r=i(n),t.refs[r.attr("ref")]=r}}(this))},e.prototype._parseRemix=function(){var t;return t=function(t){return function(e){var n,r,o,s,u,l,p,a,h;n=i(e),a=n.data();for(s in a)h=a[s],0===h.indexOf("@")&&(u=h.substring(1),a[s]=null!=t[u]?t.proxy(t[u]):function(e){return function(){if(t[e])return t[e]();throw""+e+" does not exist"}}(u));if(o=n.attr("remix"),r=t[o],null==r){if(null==c[o])throw'Remixing child "'+o+'" does not exist';r=t.addChild(o,c[o])}return p=r(a,n.attr("key"),e),!p.constructor.noTemplate&&(n.replaceWith(p.node),l=n.attr("ref"))?t.refs[l]=p.node:void 0}}(this),this.node.find("[remix]").not(this.node.find("[remix] [remix]")).each(function(){return t(this)})},e.prototype._parseEvents=function(){var t,e,n,r,o,s,u,l,p,c;if(this.remixEvent&&"object"==typeof this.remixEvent){l=this.remixEvent,c=[];for(t in l){if(r=l[t],p=t.split(","),e=p[0],u=p[1],s=p[2],e=i.trim(e),null!=u&&(u=i.trim(u),null==s?(s=u,u=null):s=i.trim(s)),n=function(t){return function(e){return function(n){var r;return n.stopPropagation(),null!=(r=t[e])?r.call(t,n):void 0}}}(this)(r),o=s?this.refs[s]:this.node,null==o)throw"Event's referencing node \""+s+'" does not exist';c.push(u?o.on(e,u,n):o.on(e,n))}return c}return"function"==typeof this.remixEvent?(this.remixEvent=this.remixEvent(),this._parseEvents()):void 0},e}(p),u=new o,c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.include(s),e.id_counter=1,e.create=function(t,n){var s,l,p;return null==n&&(n=t,t=null),s=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return r(i,t),i.include(n),i.loadTemplate(n.template),i.$id=e.id_counter++,i}(o),p=function(t){var e;return e=function(n,r,i){var o;return r||(r="$default"),o=t._getChildComp(s,r),o||(o=new s(i),o.parent=t,o.creator=e,o.key=r,t._regChildComp(o,s,r)),o._optimistRender(n),o},e.setParent=p,e.bindNode=function(t,n){return e({},n,t),e},e.get=function(e){return e||(e="$default"),t._getChildComp(s,e)},e.getAll=function(){return t._getAllChildComp(s)},e.destroyAll=function(){return i.each(e.getAll(),function(t,e){return e.destroy()})},e},l=p(u),t&&(e[t]=l),l},e}(p)})}).call(this);