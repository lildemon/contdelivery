(function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};!function(t){"function"==typeof define&&null!=define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):this.Remix=t(jQuery)}(function(i){var o,s,u,l,a,p,c;return s={bind:function(t,e){var n,r,i,o,s;for(n=t.split(" "),this.hasOwnProperty("_callbacks")||this._callbacks||(this._callbacks={}),o=0,s=n.length;s>o;o++)r=n[o],(i=this._callbacks)[r]||(i[r]=[]),this._callbacks[r].push(e);return this},one:function(t,e){var n;return this.bind(t,n=function(){return this.unbind(t,n),e.apply(this,arguments)})},trigger:function(){var e,n,r,i,o,s,u;if(e=1<=arguments.length?t.call(arguments,0):[],r=e.shift(),i=null!=(u=this._callbacks)?u[r]:void 0){for(o=0,s=i.length;s>o&&(n=i[o],n.apply(this,e)!==!1);o++);return!0}},unbind:function(t,e){var n,r,i,o,s,u,l,a,p,c;if(0===arguments.length)return this._callbacks={},this;if(!t)return this;for(r=t.split(" "),u=0,a=r.length;a>u;u++)if(s=r[u],o=null!=(c=this._callbacks)?c[s]:void 0)if(e){for(i=l=0,p=o.length;p>l;i=++l)if(n=o[i],n===e){o=o.slice(),o.splice(i,1),this._callbacks[s]=o;break}}else delete this._callbacks[s];return this}},s.on=s.bind,s.off=s.unbind,l={trace:!0,logPrefix:"(App)",log:function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],this.trace?(this.logPrefix&&e.unshift(this.logPrefix),"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,e),this):void 0}},c=["included","extended"],a=function(){function t(){"function"==typeof this.init&&this.init.apply(this,arguments)}return t.include=function(t){var n,r,i;if(!t)throw new Error("include(obj) requires obj");for(n in t)r=t[n],e.call(c,n)<0&&(this.prototype[n]=r);return null!=(i=t.included)&&i.apply(this),this},t.extend=function(t){var n,r,i;if(!t)throw new Error("extend(obj) requires obj");for(n in t)r=t[n],e.call(c,n)<0&&(this[n]=r);return null!=(i=t.extended)&&i.apply(this),this},t.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t.prototype.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t}(),i.parseHTML=i.parseHTML||function(t){return t},o=function(t){function e(){this._parseRemixChild(),this._parseTemplate(),this.initialize()}return r(e,t),e.include(s),e.extend(s),e.templateLoaded=!1,e.loadTemplate=function(t){var e,n;return"string"==typeof t?~t.indexOf("<")?(this.templateNode=i(i.parseHTML(t)),this.templateLoaded=!0):(n=i.get(t),n.done(function(t){return function(e){return t.templateNode=i(i.parseHTML(e))}}(this)),e=function(e){return function(){return e.templateNode=i(i.parseHTML("<span>Error loading template: "+t+" </span>"))}}(this),n.fail(e),n.complete(function(t){return function(){return t.templateLoaded=!0,t.trigger("template-loaded")}}(this))):this.templateLoaded=!0},e.prototype.initialize=function(){},e.prototype.onNodeCreated=function(){},e.prototype.addChild=function(t,e){return this[t]=e.setParent(this)},e.prototype.render=function(){return this.trigger("updated"),this.node},e.prototype.appendTo=function(t){return this.node.appendTo(t),this},e.prototype.nodeTrigger=function(){return this.node.trigger.apply(this.node,arguments)},e.prototype.delegateTo=function(t){return this.parent._delChildComp(this.constructor,this.key),t._regChildComp(this,this.constructor,this.key),this.parent=t,this.creator=this.creator.setParent(t),this},e.prototype.delegate=function(t){return t.delegateTo(this)},e.prototype.destroy=function(t){var e,r,i,o,s;"function"==typeof this.onDestroy&&this.onDestroy(),t||this.node.remove(),s=this.child_components;for(e in s)if(n.call(s,e)){o=s[e];for(i in o)n.call(o,i)&&(r=o[i],r.destroy(!0))}return this.off(),this.node.off(),this.parent._delChildComp(this.constructor,this.key)},e.prototype._optimistRender=function(t){var e;return this.data=t,this.constructor.templateLoaded?e=this.render(t):this.constructor.one("template-loaded",function(e){return function(){return e._parseTemplate(),e.render(t)}}(this)),this.node},e.prototype._getChildComp=function(t,e){var n,r;return null!=(n=this.child_components)&&null!=(r=n[t.$id])?r[e]:void 0},e.prototype._getAllChildComp=function(t){var e,n,r,i,o;i=null!=(r=this.child_components)?r[t.$id]:void 0,o=[];for(n in i)e=i[n],o.push(e);return o},e.prototype._regChildComp=function(t,e,n){var r,i,o;if(r=this.child_components||(this.child_components={}),i=r[o=e.$id]||(r[o]={}),null!=i[n])throw"child component already exist!";return i[n]=t,t},e.prototype._delChildComp=function(t,e){var n,r;return null!=(n=this.child_components)&&null!=(r=n[t.$id])?delete r[e]:void 0},e.prototype._parseRemixChild=function(){var t,e,n,r;if(this.remixChild&&"object"==typeof this.remixChild){n=this.remixChild,r=[];for(e in n)t=n[e],r.push(this.addChild(e,t));return r}},e.prototype._parseTemplate=function(){var t;return this.constructor.templateLoaded?(t=this.node,this.node=this.constructor.templateNode?this.constructor.templateNode.clone():i({}),t&&t.replaceWith(this.node),this._parseRefs(),this._parseRemix(),this._parseEvents(),this.onNodeCreated()):this.node=i(i.parseHTML('<span class="loading">loading..</span>'))},e.prototype._parseRefs=function(){return this.node.find("[ref]").each(function(t){return function(e,n){var r;return r=i(n),t[r.attr("ref")]=r}}(this))},e.prototype._parseRemix=function(){return this.node.find("[remix]").each(function(t){return function(e,n){var r,o,s,u,l;if(r=i(n),o=r.data("remix"),!o){o=r.data();for(s in o)l=o[s],0===l.indexOf("@")&&(u=function(e){return function(){var n;if(n=e.substring(1),t[n])return t[n]();throw""+n+" does not exist"}}(l),o[s]=u)}return r.replaceWith(t[r.attr("remix")](r.data("remix")||r.data(),r.attr("key")).node)}}(this))},e.prototype._parseEvents=function(){var t,e,n,r,o,s,u,l;if(this.remixEvent&&"object"==typeof this.remixEvent){s=this.remixEvent,l=[];for(t in s)r=s[t],u=t.split(","),e=u[0],o=u[1],e=i.trim(e),o=i.trim(o),n=function(t){return function(e){var n;return e.stopPropagation(),null!=(n=t[r])?n.call(t,e):void 0}}(this),l.push(o?this.node.on(e,o,n):this.node.on(e,n));return l}},e}(a),u=new o,p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.include(s),e.id_counter=1,e.create=function(t,n){var i,s,l;return null==n&&(n=t,t=null),i=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return r(i,t),i.include(n),i.loadTemplate(n.template),i.$id=e.id_counter++,i}(o),l=function(t){var e;return e=function(n,r){var o;return r||(r="$default"),o=t._getChildComp(i,r),o||(o=new i,o.parent=t,o.creator=e,o.key=r,t._regChildComp(o,i,r)),o._optimistRender(n),o},e.setParent=l,e.get=function(e){return e||(e="$default"),t._getChildComp(i,e)},e.getAll=function(){return t._getAllChildComp(i)},e},s=l(u),t&&(e[t]=s),s},e}(a)})}).call(this);